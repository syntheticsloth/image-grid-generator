/**
 * Image Grid Generator.
 * @copyright 2019-2020 FAL
 * @version 1.2.0
 */
!function(e,t){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}const n=o(e);let i;var r;!function(e){e[e.IE=0]="IE",e[e.Edge=1]="Edge",e[e.Chrome=2]="Chrome",e[e.Safari=3]="Safari",e[e.FireFox=4]="FireFox",e[e.Opera=5]="Opera",e[e.Other=6]="Other"}(r||(r={}));const s=(e,t)=>{const o=((e,t)=>{const{width:o,height:n}=e;return Math.min(t.width/o,t.height/n)})(e,t);return{width:e.width*o,height:e.height*o}},h=(e,t)=>{const{width:o,height:n}=e;return Math.min(1,Math.min(t.width/o,t.height/n))},a=e=>e.size(),l="absolute",c=(e,t,o=l)=>{const n=e.elt.style,{x:i,y:r}=t;return n.position=o,n.left=`${i}px`,n.top=`${r}px`,e},d=(e,t,o)=>{((e,t)=>{const o=s(a(e),t);e.size(o.width,o.height)})(e,o);const n=a(e);c(e,{x:t.x+(o.width-n.width)/2,y:t.y+(o.height-n.height)/2})},g=e=>{const{label:t,onClick:o,position:n,size:r,cursor:s}=e,h=i.createButton(t);return h.mouseClicked(o),c(h,n),h.size(r.width,r.height),s&&h.style("cursor",s),h},u=e=>{const{file:{data:t},alt:o,hide:n}=e,r=i.createImg(t,o,(()=>{const{file:t,warnOnFail:o,onLoad:n,onFail:i}=e;if(!r)return o&&console.warn(`"Failed to load ${t.name}`),void(i&&i(t));n&&n(r,t)}));return n&&r.hide(),r},f=()=>{},p={getAlt:()=>{},hide:!1,onLoadEach:f,onFailEach:f,warnOnFail:!0,onSuccess:f,onFailAny:f,onEnd:f},w=(e,t)=>{if(e.length<=0)return void(t.onEnd&&t.onEnd(e));const o=Object.assign(Object.create(p),t),{getAlt:n,hide:i,onLoadEach:r,onFailEach:s,warnOnFail:h,onSuccess:a,onEnd:l}=o;let c=o.onFailAny;const d=e.length,g=[];let w=0;for(let t=0;t<e.length;t+=1){const o=e[t];u({file:o,alt:n(o),hide:i,onLoad:(o,n)=>{r(o,n,t),g.push(o),g.length===d&&a(g),w+=1,w===d&&l(e)},onFail:o=>{s(o,t),c(e),c=f,w+=1,w===d&&l(e)},warnOnFail:h})}return g},m=1035,y=640,b=0,v={width:m-y,height:y},x={x:b,y:0},F={width:v.width-20,height:280},E={x:x.x+2,y:x.y+2},C={width:F.width-4,height:F.height-4},M={x:b,y:x.y+F.height+15},O={width:100,height:40},z={x:M.x+16+O.width,y:M.y},L={width:100,height:40},k={x:z.x+16+L.width,y:M.y},I={width:100,height:40},S={x:b,y:M.y+40+15},A={width:v.width-20,height:v.height-(F.height+15+40+15+5+30)},Y={x:b,y:v.height-30},N=70,D=30,W={width:60,height:30},X={x:v.width-20-W.width,y:Y.y},T={width:m-v.width,height:y},$={x:v.width,y:0},H={fileName:"image-grid.png",width:1080,height:1080,columns:2,rows:2,outerMargin:{top:0,bottom:0,left:0,right:0},innerMargin:0,backgroundColorCode:"#FFFFFF00",shadow:{color:"rgba(0, 0, 0, 0)",blur:0,offsetX:0,offsetY:0}},R=e=>t.safeDump(e),j=R(H),P=(e,t)=>""===e||isFinite(t)||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t?t:void 0,B=(e,t,o=-1e4,n=1e4)=>{const i=parseInt(e);return Number.isFinite(i)&&i>=o&&i<=n?i:t},J=(e,t,o=100)=>{const n=e.toString();return"string"==typeof n&&n.length>0&&n.length<=o?n:t},G="[\\da-fA-F]",V=new RegExp(`^(${G}{3}|${G}{4}|${G}{6}|${G}{8})$`),q=e=>{const t=J(e.fileName,H.fileName,255),o=B(e.width,H.width,1),n=B(e.height,H.height,1),i=B(e.columns,H.columns,1),r=B(e.rows,H.rows,1),s=(e=>{const t=H.outerMargin;if("number"==typeof e){const o=B(e,t.top);return{top:o,bottom:o,left:o,right:o}}return{top:B(e.top,t.top),bottom:B(e.bottom,t.bottom),left:B(e.left,t.left),right:B(e.right,t.right)}})(e.outerMargin),h=B(e.innerMargin,H.innerMargin),a=((e,t)=>{const o=e.toString();return"string"==typeof o?o.match(V)?`#${o}`:o:t})(e.backgroundColorCode,H.backgroundColorCode),l=(e=>{const t=H.shadow;return{color:J(e.color,t.color),blur:B(e.blur,t.blur),offsetX:B(e.offsetX,t.offsetX),offsetY:B(e.offsetY,t.offsetY)}})(e.shadow);return{fileName:t,width:o,height:n,columns:i,rows:r,outerMargin:s,innerMargin:h,backgroundColorCode:a,shadow:l}},K=e=>{const{width:t,height:o,columns:n,rows:i,outerMargin:r,innerMargin:s}=e,h=e.width-r.left-r.right,a=e.height-r.top-r.bottom;return{contentWidth:h,contentHeight:a,contentLeftX:r.left,contentTopY:r.top,contentRightX:t-r.right,contentBottomY:o-r.bottom,columnWidth:h/n,rowHeight:a/i,cellWidth:(h-(n-1)*s)/n,cellHeight:(a-(i-1)*s)/i}},Q=()=>{},U={onChange:Q,onMouseEnter:Q,onMouseLeave:Q},Z=e=>{const{onChange:o,onMouseEnter:n,onMouseLeave:r}=Object.assign(Object.create(U),e),s=(e=>{const{position:t,size:o,initialValue:n}=e,r=i.createElement("textarea",n);return c(r,t).size(o.width,o.height),r})({position:S,size:A,initialValue:j}),h={element:s,contentText:j,parameters:H,monitorIntervalId:void 0},a=()=>{const e=s.value().toString();e!==h.contentText&&(h.contentText=e,h.parameters=(e=>{if("string"!=typeof e)return H;const o=e.trim();try{return"{"===o.substr(0,1)?q(JSON.parse(o,P)):q(t.safeLoad(o))}catch(e){return H}})(e),o(h))},l=e=>{h.element.value(e),a()},d=e=>l((e=>JSON.stringify(e,void 0,2))(e)),u=s.elt;u.addEventListener("focus",(()=>{h.monitorIntervalId=setInterval(a,100)})),u.addEventListener("blur",(()=>{const{monitorIntervalId:e}=h;e&&(clearInterval(e),h.monitorIntervalId=void 0)})),u.addEventListener("mouseenter",n.bind(void 0,h)),u.addEventListener("mouseleave",r.bind(void 0,h));const f=i.createSelect();f.position(Y.x,Y.y),f.size(N,D),f.option("YAML"),f.option("JSON"),f.changed((()=>{switch(f.value().toString()){case"YAML":e=h.parameters,l(R(e));break;case"JSON":d(h.parameters)}var e}));return g({label:"reset",onClick:()=>{l(j),f.value("YAML")},position:X,size:W,cursor:"pointer"}).style("font-size","medium"),h},_=(e,t,o,n,i)=>{const r=Math.floor(t/n),s=t%n,h={x:o.x+i.width*s,y:o.y+i.height*r};d(e,h,i)},ee=(e,t)=>{const{position:o,size:n,cellSize:i,columns:r,elements:s}=e;t.show(),_(t,s.length,o,r,i),e.elements.push(t);Math.ceil(s.length/r)*i.height>n.height&&((e,t)=>{const{position:o,size:n,elements:i}=e;e.columns=t;const r=n.width/t;e.cellSize={width:r,height:r};for(let n=0;n<i.length;n+=1)_(i[n],n,o,t,e.cellSize)})(e,r+1)},te=e=>{const{width:t,height:o,columns:n,rows:r,innerMargin:s}=e,{contentWidth:a,contentHeight:l,contentLeftX:c,contentTopY:d,contentRightX:g,contentBottomY:u,columnWidth:f,rowHeight:p,cellWidth:w,cellHeight:m}=K(e);i.push(),i.translate(i.width/2,i.height/2);const y=h(e,i);if(i.scale(y),i.strokeWeight(1/y),i.translate(-t/2,-o/2),i.stroke(255,64,128),i.noFill(),i.rect(1,1,t-2,o-2),i.rect(c+1,d+1,a-2,l-2),0===s){for(let e=1,t=c;e<n;e+=1)t+=f,i.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=p,i.line(c,t,g,t)}else{for(let e=1,t=c;e<n;e+=1)t+=w,i.line(t,d,t,u),t+=s,i.line(t,d,t,u);for(let e=1,t=d;e<r;e+=1)t+=m,i.line(c,t,g,t),t+=s,i.line(c,t,g,t)}i.pop()},oe=[];let ne,ie,re,se,he,ae=!1,le=()=>{i.background(255),i.push(),i.stroke(224),i.noFill(),i.strokeWeight(1),i.rect(1,1,i.width-2,i.height-2),i.pop()};const ce=()=>{ae=!0,i.cursor(i.WAIT),re.style("cursor","wait"),se.style("cursor","wait"),he.style("cursor","wait")},de=()=>{ae=!1,i.cursor(i.ARROW),re.style("cursor","pointer"),se.style("cursor","pointer"),he.style("cursor","pointer")},ge=e=>t=>{if(t.length<=0)return;const o=((e,t)=>{const{width:o,height:n,rows:r,columns:h,outerMargin:a,innerMargin:l,backgroundColorCode:c,shadow:d}=t,g=e.length,{cellWidth:u,cellHeight:f}=K(t),p=i.createGraphics(o,n),w=i.color(c);i.alpha(w)>0&&p.background(w),p.push(),p.imageMode(i.CENTER),p.translate(a.left+u/2,a.top+f/2);let m=0;for(let t=0,o=0;t<r;t+=1,o+=f+l)for(let t=0,n=0;t<h&&!(m>=g);t+=1,n+=u+l){const t=e[m++],i=s(t,{width:u,height:f});p.push();const r=p.drawingContext;r.shadowColor=d.color,r.shadowBlur=d.blur,r.shadowOffsetX=d.offsetX,r.shadowOffsetY=d.offsetY,p.image(t,n,o,i.width,i.height),p.pop()}return p.pop(),p})(t,e),n=((e,t)=>{const o=h(e,t);return{width:e.width*o,height:e.height*o}})(o,i);le=()=>{i.background(255),i.image(o,i.width/2,i.height/2,n.width,n.height)},le(),ne=o},ue=()=>{if(ae)return;const{parameters:e}=ie;if(e.rows*e.columns<1)return;const t=oe;t.length<=0||(ce(),w(t,{hide:!0,warnOnFail:!0,onSuccess:ge(e),onEnd:de}))},fe=()=>{if(ae)return;const{parameters:e}=ie,t=e.rows*e.columns;if(t<1)return;const o=i.shuffle(oe).slice(0,t);o.length<=0||(ce(),w(o,{hide:!0,warnOnFail:!0,onSuccess:ge(e),onEnd:de}))},pe=()=>{ne&&i.save(ne,ie.parameters.fileName)},we=()=>{const e=(e=>{const{position:t,size:o,initialColumns:n}=e,i=o.width/n;return{position:t,size:o,columns:n,cellSize:{width:i,height:i},elements:[]}})({position:E,size:C,initialColumns:4}),t=(e,t)=>{e.style("pointer-events","none"),oe.push(t)};(e=>{const{position:t,size:o,onDrop:n}=e,r=i.createDiv("Drop image files here"),s=()=>{r.style("background-color","#FDFDFD"),r.style("cursor","auto")};c(r,t).size(o.width,o.height),r.addClass("drop-zone");const h=r.elt;r.dragOver((()=>{r.style("background-color","#F0FAFF"),r.style("cursor","wait")})).dragLeave(s).drop(n,(()=>{s(),h.innerHTML=""})),s()})({position:x,size:F,onDrop:o=>((e,t,o)=>{"image"===t.type?u({file:t,alt:t.name,onLoad:(t,n)=>{ee(e,t),o(t,n)}}).hide():console.warn("Dropped file that is not an image:",t)})(e,o,t)})},me=()=>{switch((()=>{const e=window.navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")?r.IE:-1!==e.indexOf("edge")?r.Edge:-1!==e.indexOf("chrome")?r.Chrome:-1!==e.indexOf("safari")?r.Safari:-1!==e.indexOf("firefox")?r.FireFox:-1!==e.indexOf("opera")?r.Opera:r.Other})()){case r.IE:return i.createP("Internet Explorer is not supported."),i.createP("Please use another browser."),!1;case r.Edge:return i.createP("Microsoft Edge is not supported."),i.createP("Please use another browser."),!1;default:return!0}},ye=()=>{if(!me())return;const{width:e,height:t}=T,o=i.createCanvas(e,t);c(o,$),window.addEventListener("dragover",(e=>{e.preventDefault()}),!1),window.addEventListener("drop",(e=>{e.preventDefault(),e.stopPropagation()}),!1),i.imageMode(i.CENTER),we(),re=g({label:"generate",onClick:ue,position:M,size:O,cursor:"pointer"}),se=g({label:"random",onClick:fe,position:z,size:L,cursor:"pointer"}),he=g({label:"save",onClick:pe,position:k,size:I,cursor:"pointer"}),ie=Z({onMouseEnter:e=>{te(e.parameters)},onMouseLeave:()=>{le()},onChange:e=>{le(),te(e.parameters)}}),i.background(255),te(H)};new n.default((e=>{(e=>{i=e})(e),i.setup=ye}),document.getElementById("ImageGridResult")||document.body)}(p5,jsyaml);